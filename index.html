
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>YAML</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc" class="toc-list-h1">
          <li>
            <a href="#yaml" class="toc-h1 toc-link" data-title="YAML">YAML</a>
          </li>
          <li>
            <a href="#pure-javascript" class="toc-h1 toc-link" data-title="Pure JavaScript">Pure JavaScript</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#yaml-parse" class="toc-h2 toc-link" data-title="YAML.parse">YAML.parse</a>
                  </li>
                  <li>
                    <a href="#yaml-stringify" class="toc-h2 toc-link" data-title="YAML.stringify">YAML.stringify</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#data-schema" class="toc-h1 toc-link" data-title="Data Schema">Data Schema</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#tags" class="toc-h2 toc-link" data-title="Tags">Tags</a>
                  </li>
                  <li>
                    <a href="#yaml-defaultoptions" class="toc-h2 toc-link" data-title="YAML.defaultOptions">YAML.defaultOptions</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#yaml-objects" class="toc-h1 toc-link" data-title="YAML Objects">YAML Objects</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#yaml-parsedocuments" class="toc-h2 toc-link" data-title="YAML.parseDocuments">YAML.parseDocuments</a>
                  </li>
                  <li>
                    <a href="#yaml-document" class="toc-h2 toc-link" data-title="YAML.Document">YAML.Document</a>
                  </li>
                  <li>
                    <a href="#yaml-createnode" class="toc-h2 toc-link" data-title="YAML.createNode">YAML.createNode</a>
                  </li>
                  <li>
                    <a href="#ast-nodes" class="toc-h2 toc-link" data-title="AST Nodes">AST Nodes</a>
                  </li>
                  <li>
                    <a href="#comments" class="toc-h2 toc-link" data-title="Comments">Comments</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#cst-parser" class="toc-h1 toc-link" data-title="CST Parser">CST Parser</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#parsecst" class="toc-h2 toc-link" data-title="parseCST">parseCST</a>
                  </li>
                  <li>
                    <a href="#cst-nodes" class="toc-h2 toc-link" data-title="CST Nodes">CST Nodes</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#errors" class="toc-h1 toc-link" data-title="Errors">Errors</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#yamlreferenceerror" class="toc-h2 toc-link" data-title="YAMLReferenceError">YAMLReferenceError</a>
                  </li>
                  <li>
                    <a href="#yamlsemanticerror" class="toc-h2 toc-link" data-title="YAMLSemanticError">YAMLSemanticError</a>
                  </li>
                  <li>
                    <a href="#yamlsyntaxerror" class="toc-h2 toc-link" data-title="YAMLSyntaxError">YAMLSyntaxError</a>
                  </li>
                  <li>
                    <a href="#yamlwarning" class="toc-h2 toc-link" data-title="YAMLWarning">YAMLWarning</a>
                  </li>
              </ul>
          </li>
      </div>
        <ul class="toc-footer">
            <li><a href='https://github.com/eemeli/yaml/releases'>Version 1.0.0-rc.4 (changelog)</a></li>
            <li><a href='https://github.com/eemeli/yaml'>github.com/eemeli/yaml</a></li>
            <li><a href='https://www.npmjs.com/package/yaml'>npm i yaml@next</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='yaml'>YAML</h1>
<blockquote>
<p>To install:</p>
</blockquote>
<pre class="highlight sh tab-shell"><code>npm install yaml@next
<span class="c"># or</span>
yarn add yaml@next
</code></pre>
<blockquote>
<p>To use:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">import</span> <span class="nx">YAML</span> <span class="nx">from</span> <span class="s1">'yaml'</span>
<span class="c1">// or</span>
<span class="kr">const</span> <span class="nx">YAML</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'yaml'</span><span class="p">).</span><span class="k">default</span>
</code></pre>
<p><code>yaml</code> is a JavaScript parser and stringifier for <a href="http://yaml.org/">YAML</a>, a human friendly data serialization standard. It supports almost all aspects of the 1.2 version of the spec for both parsing and stringifying data, as well as a few of the most common extensions.</p>

<p>The library is released under the ISC open source license, and the code is <a href="https://github.com/eemeli/yaml/">available on GitHub</a>. It has no external dependencies, and is usable in both browser and node environments.</p>

<p>The API provided by <code>yaml</code> has three layers, depending on how deep you need to go: <a href="#pure-javascript">Pure JavaScript</a>, <a href="#yaml-objects">YAML Objects</a>, and the <a href="#cst-parser">CST Parser</a>. The first has the simplest API and &quot;just works&quot;, the second gets you all the bells and whistles supported by the library along with a decent AST, and the third is the closest to YAML source, making it fast, raw, and crude.</p>
<h1 id='pure-javascript'>Pure JavaScript</h1><pre class="highlight yaml tab-yaml"><code><span class="c1"># file.yml</span>
<span class="na">YAML</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">A human-readable data serialization language</span>
  <span class="pi">-</span> <span class="s">https://en.wikipedia.org/wiki/YAML</span>
<span class="na">yaml</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">A complete JavaScript implementation</span>
  <span class="pi">-</span> <span class="s">https://www.npmjs.com/package/yaml</span>
</code></pre>
<p>At its simplest, you can use <code>YAML.parse(str)</code> and <code>YAML.stringify(value)</code> just as you&#39;d use <code>JSON.parse(str)</code> and <code>JSON.stringify(value)</code>. If that&#39;s enough for you, everything else in these docs is really just implementation details.</p>
<h2 id='yaml-parse'>YAML.parse</h2><pre class="highlight javascript"><code><span class="kr">import</span> <span class="nx">fs</span> <span class="nx">from</span> <span class="s1">'fs'</span>
<span class="kr">import</span> <span class="nx">YAML</span> <span class="nx">from</span> <span class="s1">'yaml'</span>

<span class="nx">YAML</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">'3.14159'</span><span class="p">)</span>
<span class="c1">// 3.14159</span>

<span class="nx">YAML</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">'[ true, false, maybe, null ]\n'</span><span class="p">)</span>
<span class="c1">// [ true, false, 'maybe', null ]</span>

<span class="kr">const</span> <span class="nx">file</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">'./file.yml'</span><span class="p">,</span> <span class="s1">'utf8'</span><span class="p">)</span>
<span class="nx">YAML</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
<span class="c1">// { YAML:</span>
<span class="c1">//   [ 'A human-readable data serialization language',</span>
<span class="c1">//     'https://en.wikipedia.org/wiki/YAML' ],</span>
<span class="c1">//   yaml:</span>
<span class="c1">//   [ 'A complete JavaScript implementation',</span>
<span class="c1">//     'https://www.npmjs.com/package/yaml' ] }</span>
</code></pre><h4 id='yaml-parse-str-options-any'><code>YAML.parse(str, options = {}): any</code></h4>
<p><code>str</code> should be a string with YAML formatting, while <code>options</code> is an optional configuration object with the same shape as <a href="#yaml-defaultoptions"><code>YAML.defaultOptions</code></a>.</p>

<p>The returned value will match the type of the root value of the parsed YAML document, so Maps become objects, Sequences arrays, and scalars result in nulls, booleans, numbers and strings.</p>

<p><code>YAML.parse</code> may throw on error, and it may log warnings using <code>console.warn</code>. It only supports input consisting of a single YAML document; for multi-document support you should use <code>YAML.parseDocuments</code>.</p>
<h2 id='yaml-stringify'>YAML.stringify</h2><pre class="highlight javascript"><code><span class="nx">YAML</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="mf">3.14159</span><span class="p">)</span>
<span class="c1">// '3.14159\n'</span>

<span class="nx">YAML</span><span class="p">.</span><span class="nx">stringify</span><span class="p">([</span><span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="s1">'maybe'</span><span class="p">,</span> <span class="kc">null</span><span class="p">])</span>
<span class="c1">// `- true</span>
<span class="c1">// - false</span>
<span class="c1">// - maybe</span>
<span class="c1">// - null</span>
<span class="c1">// `</span>

<span class="nx">YAML</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="na">number</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="na">plain</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">,</span> <span class="na">block</span><span class="p">:</span> <span class="s1">'two\nlines\n'</span> <span class="p">})</span>
<span class="c1">// `number: 3</span>
<span class="c1">// plain: string</span>
<span class="c1">// block: &gt;</span>
<span class="c1">//   two</span>
<span class="c1">//</span>
<span class="c1">//   lines</span>
<span class="c1">// `</span>
</code></pre><h4 id='yaml-stringify-value-options-string'><code>YAML.stringify(value, options = {}): string</code></h4>
<p><code>value</code> can be of any type, while <code>options</code> is an optional configuration object with the same shape as <a href="#yaml-defaultoptions"><code>YAML.defaultOptions</code></a>.</p>

<p>The returned string will always include <code>\n</code> as the last character, as is expected of YAML documents.</p>

<p>As strings in particular may be represented in a number of different styles, the simplest option for the value in question will always be chosen, depending mostly on the presence of escaped or control characters and leading &amp; trailing whitespace.</p>

<p>To create a stream of documents, you may call <code>YAML.stringify</code> separately for each document&#39;s <code>value</code>, and concatenate the documents with the string <code>...\n</code> as a separator.</p>
<h1 id='data-schema'>Data Schema</h1>
<p>A YAML schema is a combination of a set of tags and a mechanism for resolving non-specific tags, i.e. values that do not have an explicit tag such as <code>!!int</code>. The recommended schema is the &quot;core&quot; schema; it&#39;s arguably the most common, and is the default for <code>yaml</code>.</p>
<h2 id='tags'>Tags</h2><pre class="highlight javascript"><code><span class="nx">YAML</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">'"42"'</span><span class="p">)</span>
<span class="c1">// '42'</span>

<span class="nx">YAML</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">'!!int "42"'</span><span class="p">)</span>
<span class="c1">// 42</span>

<span class="nx">YAML</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s2">`
%TAG ! tag:example.com,2018:app/
---
!foo 42
`</span><span class="p">)</span>
<span class="c1">// {[ YAMLWarning:</span>
<span class="c1">//    The tag tag:example.com,2018:app/foo is unavailable,</span>
<span class="c1">//    falling back to tag:yaml.org,2002:str ]}</span>
<span class="c1">// '42'</span>
</code></pre>
<p>The default prefix for YAML tags is <code>tag:yaml.org,2002:</code>, for which the shorthand <code>!!</code> is used when stringified. Shorthands for other prefixes may also be defined by document-specific directives, e.g. <code>!e!</code> or just <code>!</code> for <code>tag:example.com,2018:app/</code>, but this is not required to use a tag with a different prefix.</p>

<p>During parsing, unresolved tags should not result in errors (though they will be noted as <code>warnings</code>), with the tagged value being parsed according to the data type that it would have under automatic tag resolution rules. This should not result in any data loss, allowing such tags to be handled by the calling app.</p>

<p>In order to have <code>yaml</code> provide you with automatic parsing and stringification of non-standard data types, it will need to be configured with a suitable tag object. For an example of what&#39;s required, the optional <a href="https://github.com/eemeli/yaml/blob/master/src/schema/_timestamp.js"><code>!!timestamp</code></a> and <a href="https://github.com/eemeli/yaml/blob/master/src/schema/_binary.js"><code>!!binary</code></a> tags should provide decent examples.</p>
<h2 id='yaml-defaultoptions'>YAML.defaultOptions</h2>
<p>These values set the default options used by <code>YAML</code> methods, and may be overridden by the <code>options</code> arguments of document-specific functions.</p>
<pre class="highlight javascript"><code><span class="nx">YAML</span><span class="p">.</span><span class="nx">defaultOptions</span><span class="p">.</span><span class="nx">merge</span> <span class="o">=</span> <span class="kc">true</span>

<span class="kr">const</span> <span class="nx">mergeResult</span> <span class="o">=</span> <span class="nx">YAML</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s2">`
source: &amp;base { a: 1, b: 2 }
target:
  &lt;&lt;: *base
  b: base
`</span><span class="p">)</span>

<span class="nx">mergeResult</span><span class="p">.</span><span class="nx">target</span>
<span class="c1">// { a: 1, b: 'base' }</span>
</code></pre>
<table><thead>
<tr>
<th>Option</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>merge</td>
<td>false</td>
<td>Enable support for <code>&lt;&lt;</code> merge keys</td>
</tr>
<tr>
<td>schema</td>
<td>&#39;core&#39;</td>
<td>The schema to use, either one of <code>&#39;core&#39;</code>, <code>&#39;extended&#39;</code>, <code>&#39;failsafe&#39;</code> or <code>&#39;json&#39;</code>, or an array of tag objects</td>
</tr>
<tr>
<td>tags</td>
<td>null</td>
<td>Array of additional tags to include in the schema</td>
</tr>
</tbody></table>

<p><strong>Merge</strong> keys are a <a href="http://yaml.org/type/merge.html">YAML 1.1 feature</a> that is not officially a part of the 1.2 spec. To use a merge key, assign an alias node or an array of alias nodes as the value of a <code>&lt;&lt;</code> key in a mapping.</p>
<pre class="highlight javascript"><code><span class="nx">YAML</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">'3'</span><span class="p">)</span> <span class="c1">// 3</span>
<span class="nx">YAML</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">'3'</span><span class="p">,</span> <span class="p">{</span> <span class="na">schema</span><span class="p">:</span> <span class="s1">'failsafe'</span> <span class="p">})</span> <span class="c1">// '3'</span>

<span class="nx">YAML</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">'No'</span><span class="p">)</span> <span class="c1">// 'No'</span>
<span class="nx">YAML</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">'No'</span><span class="p">,</span> <span class="p">{</span> <span class="na">schema</span><span class="p">:</span> <span class="s1">'json'</span> <span class="p">})</span> <span class="c1">// SyntaxError: Unresolved plain scalar "No"</span>
<span class="nx">YAML</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">'No'</span><span class="p">,</span> <span class="p">{</span> <span class="na">schema</span><span class="p">:</span> <span class="s1">'extended'</span> <span class="p">})</span> <span class="c1">// false</span>
</code></pre>
<p>Aside from defining the language structure, the YAML 1.2 spec defines a number of different <strong>schemas</strong> that may be used. The default is the <a href="http://yaml.org/spec/1.2/spec.html#id2804923">core schema</a>, which is the most common one. The <a href="http://yaml.org/spec/1.2/spec.html#id2803231">JSON schema</a> is effectively the minimum schema required to parse JSON; both it and the core schema are supersets of the minimal <a href="http://yaml.org/spec/1.2/spec.html#id2802346">failsafe schema</a>.</p>

<p>The <strong>extended</strong> schema matches the more liberal <a href="http://yaml.org/type/">YAML 1.1 types</a>, including binary data and timestamps as distinct tags as well as accepting greater variance in scalar values (with e.g. <code>&#39;No&#39;</code> being parsed as <code>false</code> rather than a string value). The <code>!!value</code> and <code>!!yaml</code> types are not supported.</p>
<pre class="highlight javascript"><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">timestamp</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'yaml/types/timestamp'</span>

<span class="nx">YAML</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">'!!timestamp 2001-12-15 2:59:43'</span><span class="p">)</span>
<span class="c1">// {[ YAMLWarning:</span>
<span class="c1">//    The tag tag:yaml.org,2002:timestamp is unavailable,</span>
<span class="c1">//    falling back to tag:yaml.org,2002:str ]}</span>
<span class="c1">// '2001-12-15 2:59:43'</span>

<span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span> <span class="na">tags</span><span class="p">:</span> <span class="p">[</span><span class="nx">timestamp</span><span class="p">]</span> <span class="p">}</span>

<span class="nx">YAML</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">'2001-12-15 2:59:43'</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
<span class="c1">// '2001-12-15T02:59:43.000Z'</span>

<span class="kr">const</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nx">YAML</span><span class="p">.</span><span class="nx">parseDocuments</span><span class="p">(</span><span class="s1">'2001-12-15 2:59:43'</span><span class="p">,</span> <span class="nx">options</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nx">doc</span><span class="p">.</span><span class="nx">contents</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">toDateString</span><span class="p">()</span>
<span class="c1">// 'Sat Dec 15 2001'</span>
</code></pre>
<p>The easiest way to extend a schema is by defining the additional <strong>tags</strong> that you wish to support. For further customisation, <code>schema</code> may also be set to a completely custom array of types, or <code>tags</code> may be a function that&#39;ll then be passed the named schema as an argument, and may add to or otherwise modify it as necessary.</p>
<h1 id='yaml-objects'>YAML Objects</h1>
<p>In order to work with YAML features not directly supported by native JavaScript data types, such as comments and non-string keys, <code>yaml</code> provides the <code>YAML.Document</code> API.</p>
<h2 id='yaml-parsedocuments'>YAML.parseDocuments</h2><pre class="highlight javascript"><code><span class="kr">import</span> <span class="nx">fs</span> <span class="nx">from</span> <span class="s1">'fs'</span>
<span class="kr">import</span> <span class="nx">YAML</span> <span class="nx">from</span> <span class="s1">'yaml'</span>

<span class="kr">const</span> <span class="nx">file</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">'./file.yml'</span><span class="p">,</span> <span class="s1">'utf8'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">docs</span> <span class="o">=</span> <span class="nx">YAML</span><span class="p">.</span><span class="nx">parseDocuments</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
<span class="nx">docs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">contents</span>
<span class="c1">// YAMLMap {</span>
<span class="c1">//   items:</span>
<span class="c1">//    [ Pair {</span>
<span class="c1">//        key: Scalar { value: 'YAML', range: [ 0, 4 ] },</span>
<span class="c1">//        value:</span>
<span class="c1">//         YAMLSeq {</span>
<span class="c1">//           items:</span>
<span class="c1">//            [ Scalar {</span>
<span class="c1">//                value: 'A human-readable data serialization language',</span>
<span class="c1">//                range: [ 10, 55 ] },</span>
<span class="c1">//              Scalar {</span>
<span class="c1">//                value: 'https://en.wikipedia.org/wiki/YAML',</span>
<span class="c1">//                range: [ 59, 94 ] } ],</span>
<span class="c1">//           tag: 'tag:yaml.org,2002:seq',</span>
<span class="c1">//           range: [ 8, 94 ] } },</span>
<span class="c1">//      Pair {</span>
<span class="c1">//        key: Scalar { value: 'yaml', range: [ 94, 98 ] },</span>
<span class="c1">//        value:</span>
<span class="c1">//         YAMLSeq {</span>
<span class="c1">//           items:</span>
<span class="c1">//            [ Scalar {</span>
<span class="c1">//                value: 'A complete JavaScript implementation',</span>
<span class="c1">//                range: [ 104, 141 ] },</span>
<span class="c1">//              Scalar {</span>
<span class="c1">//                value: 'https://www.npmjs.com/package/yaml',</span>
<span class="c1">//                range: [ 145, 180 ] } ],</span>
<span class="c1">//           tag: 'tag:yaml.org,2002:seq',</span>
<span class="c1">//           range: [ 102, 180 ] } } ],</span>
<span class="c1">//   tag: 'tag:yaml.org,2002:map',</span>
<span class="c1">//   range: [ 0, 180 ] }</span>
</code></pre><h4 id='yaml-parsedocuments-str-options-yaml-document'><code>YAML.parseDocuments(str, options = {}): YAML.Document[]</code></h4>
<p>When parsing YAML, the input string <code>str</code> is considered as a stream of documents separated from each other by <code>...</code> document end marker lines. <code>YAML.parseDocuments</code> (used internally by <code>YAML.parse</code>) will return an array of <code>Document</code> objects that allow these documents to be parsed and manipulated with more control.</p>

<p>This function should never throw; errors and warnings are included in the documents&#39; <code>errors</code> and <code>warnings</code> arrays. In particular, if <code>errors</code> is not empty it&#39;s likely that the document&#39;s parsed <code>contents</code> are not entirely correct.</p>

<p>The returned documents&#39; <code>contents</code> will always consist of <code>Scalar</code>, <code>Map</code>, <code>Seq</code> or <code>null</code> values.</p>
<h2 id='yaml-document'>YAML.Document</h2><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">doc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">YAML</span><span class="p">.</span><span class="nx">Document</span><span class="p">()</span>
<span class="c1">// Document {</span>
<span class="c1">//   anchors: {},</span>
<span class="c1">//   commentBefore: null,</span>
<span class="c1">//   comment: null,</span>
<span class="c1">//   contents: null,</span>
<span class="c1">//   errors: [],</span>
<span class="c1">//   tagPrefixes: [],</span>
<span class="c1">//   schema:</span>
<span class="c1">//    Schema {</span>
<span class="c1">//      merge: false,</span>
<span class="c1">//      schema:</span>
<span class="c1">//       [ ...,</span>
<span class="c1">//         { class: [Function: Boolean],</span>
<span class="c1">//           tag: 'tag:yaml.org,2002:bool',</span>
<span class="c1">//           test: /^(?:true|false)$/i,</span>
<span class="c1">//           resolve: [Function: resolve] },</span>
<span class="c1">//         ... ] },</span>
<span class="c1">//   version: null,</span>
<span class="c1">//   warnings: [] }</span>

<span class="nx">doc</span><span class="p">.</span><span class="nx">version</span> <span class="o">=</span> <span class="kc">true</span>
<span class="nx">doc</span><span class="p">.</span><span class="nx">commentBefore</span> <span class="o">=</span> <span class="s1">' A commented document'</span>
<span class="nx">doc</span><span class="p">.</span><span class="nx">contents</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'some'</span><span class="p">,</span> <span class="s1">'values'</span><span class="p">,</span> <span class="p">{</span> <span class="na">balloons</span><span class="p">:</span> <span class="mi">99</span> <span class="p">}]</span>

<span class="nb">String</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span>
<span class="c1">// # A commented document</span>
<span class="c1">// %YAML 1.2</span>
<span class="c1">// ---</span>
<span class="c1">// - some</span>
<span class="c1">// - values</span>
<span class="c1">// - balloons: 99</span>
</code></pre><h4 id='new-yaml-document-options'><code>new YAML.Document(options = {})</code></h4><h4 id='new-yaml-document-schema'><code>new YAML.Document(schema)</code></h4>
<p>A YAML Document will need to include a schema definition. Its constructor may thefore be called with a ready <code>schema</code>, or the <code>options</code> (see <a href="#yaml-defaultoptions"><code>YAML.defaultOptions</code></a>) required for its construction.</p>

<table><thead>
<tr>
<th>Member</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>commentBefore</td>
<td><code>string?</code></td>
<td>A comment at the very beginning of the document.</td>
</tr>
<tr>
<td>comment</td>
<td><code>string?</code></td>
<td>A comment at the end of the document.</td>
</tr>
<tr>
<td>contents</td>
<td><a href="#ast-nodes"><code>Node</code></a>&vert;<code>any</code></td>
<td>The document contents.</td>
</tr>
<tr>
<td>errors</td>
<td><code>Error[]</code></td>
<td>Errors encountered during parsing.</td>
</tr>
<tr>
<td>schema</td>
<td><code>Schema</code></td>
<td>The schema used with the document.</td>
</tr>
<tr>
<td>tagPrefixes</td>
<td><code>Prefix[]</code></td>
<td>Array of prefixes; each will have a string <code>handle</code> that starts and ends with <code>!</code> and a string <code>prefix</code> that the handle will be replaced by.</td>
</tr>
<tr>
<td>version</td>
<td><code>string?</code></td>
<td>The parsed version of the source document; if true-ish, stringified output will include a <code>%YAML 1.2</code> directive.</td>
</tr>
<tr>
<td>warnings</td>
<td><code>Error[]</code></td>
<td>Warnings encountered during parsing.</td>
</tr>
</tbody></table>

<p>The Document members are all modifiable, though it&#39;s unlikely that you&#39;ll have reason to change <code>errors</code>, <code>schema</code> or <code>warnings</code>. In particular you may be interested in both reading and writing <strong><code>contents</code></strong>. Although <code>YAML.parseDocuments()</code> will leave it with <code>Map</code>, <code>Seq</code>, <code>Scalar</code> or <code>null</code> contents, it can be set to anything.</p>

<table><thead>
<tr>
<th>Method</th>
<th>Return type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>parse(cst)</td>
<td><code>Document</code></td>
<td>Parse a CST into this document</td>
</tr>
<tr>
<td>listNonDefaultTags()</td>
<td><code>string[]</code></td>
<td>List the tags used in the document that are not in the default <code>tag:yaml.org,2002:</code> namespace.</td>
</tr>
<tr>
<td>setTagPrefix(handle, prefix)</td>
<td><code>undefined</code></td>
<td>Set <code>handle</code> as a shorthand string for the <code>prefix</code> tag namespace.</td>
</tr>
<tr>
<td>toJSON()</td>
<td><code>any</code></td>
<td>A plain JavaScript representation of the document <code>contents</code>.</td>
</tr>
<tr>
<td>toString()</td>
<td><code>string</code></td>
<td>A YAML representation of the document.</td>
</tr>
</tbody></table>

<p><strong><code>parse(cst)</code></strong> is mostly an internal method, modifying the document according to the contents of the parsed <code>cst</code>. Calling this multiple times on a Document is not recommended.</p>

<p>To define a tag prefix to use when stringifying, use <strong><code>setTagPrefix(handle, prefix)</code></strong> rather than setting a value directly in <code>tagPrefixes</code>. This will guarantee that the <code>handle</code> is valid (by throwing an error), and will overwrite any previous definition for the <code>handle</code>. Use an empty <code>prefix</code> value to remove a prefix.</p>

<p>For a plain JavaScript representation of the document, <strong><code>toJSON()</code></strong> is your friend. Do note that it will call <code>toJSON()</code> methods recursively on the contents, so e.g. <code>Date</code> objects will also be stringified.</p>

<p>Conversely, to stringify a document as YAML, use <strong><code>toString()</code></strong>. This will also be called by <code>String(doc)</code>. This method will throw if the <code>errors</code> array is not empty.</p>
<h2 id='yaml-createnode'>YAML.createNode</h2><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">seq</span> <span class="o">=</span> <span class="nx">YAML</span><span class="p">.</span><span class="nx">createNode</span><span class="p">([</span><span class="s1">'some'</span><span class="p">,</span> <span class="s1">'values'</span><span class="p">,</span> <span class="p">{</span> <span class="na">balloons</span><span class="p">:</span> <span class="mi">99</span> <span class="p">}])</span>
<span class="c1">// YAMLSeq {</span>
<span class="c1">//   items:</span>
<span class="c1">//    [ Scalar { value: 'some' },</span>
<span class="c1">//      Scalar { value: 'values' },</span>
<span class="c1">//      YAMLMap {</span>
<span class="c1">//        items:</span>
<span class="c1">//         [ Pair {</span>
<span class="c1">//             key: Scalar { value: 'balloons' },</span>
<span class="c1">//             value: Scalar { value: 99 } } ] } ] }</span>

<span class="kr">const</span> <span class="nx">doc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">YAML</span><span class="p">.</span><span class="nx">Document</span><span class="p">()</span>
<span class="nx">doc</span><span class="p">.</span><span class="nx">contents</span> <span class="o">=</span> <span class="nx">seq</span>
<span class="nx">seq</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">comment</span> <span class="o">=</span> <span class="s1">' A commented item'</span>
<span class="nb">String</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span>
<span class="c1">// - some # A commented item</span>
<span class="c1">// - values</span>
<span class="c1">// - balloons: 99</span>
</code></pre><h4 id='yaml-createnode-value-map-seq-scalar'><code>YAML.createNode(value): Map | Seq | Scalar</code></h4><h4 id='yaml-createnode-value-false-map-seq-string-number-boolean-null'><code>YAML.createNode(value, false): Map | Seq | string | number | boolean | null</code></h4>
<p><code>YAML.createNode</code> recursively turns objects into <code>Map</code> and arrays to <code>Seq</code> <a href="#collections">collections</a>. If the second <code>wrapScalars</code> argument is undefined or <code>true</code>, it also wraps plain values in <code>Scalar</code> objects. Its primary use is to enable attaching comments or other metadata to a value, or to otherwise exert more fine-grained control over the stringified output.</p>

<p>To stringify the output of <code>YAML.createNode</code> as YAML, you&#39;ll need to assign it to the <code>contents</code> of a Document (or somewhere within said contents), as the document&#39;s schema is required for YAML string output.</p>
<h2 id='ast-nodes'>AST Nodes</h2><pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Node</span> <span class="p">{</span>
  <span class="nl">comment</span><span class="p">:</span> <span class="p">?</span><span class="nx">string</span><span class="p">,</span>   <span class="c1">// a comment on or immediately after this</span>
  <span class="nx">commentBefore</span><span class="p">:</span> <span class="p">?</span><span class="nx">string</span><span class="p">,</span> <span class="c1">// a comment before this</span>
  <span class="nx">range</span><span class="p">:</span> <span class="p">?[</span><span class="nx">number</span><span class="p">,</span> <span class="nx">number</span><span class="p">],</span>
      <span class="c1">// the [start, end] range of characters of the source parsed</span>
      <span class="c1">// into this node (undefined for pairs or if not parsed)</span>
  <span class="nx">tag</span><span class="p">:</span> <span class="p">?</span><span class="nx">string</span><span class="p">,</span>       <span class="c1">// a fully qualified tag, if required</span>
  <span class="nx">toJSON</span><span class="p">():</span> <span class="nx">any</span>       <span class="c1">// a plain JS representation of this node</span>
<span class="p">}</span>
</code></pre>
<p>After parsing, the <code>contents</code> value of each <code>YAML.Document</code> is the root of an <a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">Abstract Syntax Tree</a> of nodes representing the document (or <code>null</code> for an empty document).</p>

<p>For scalar values, the <code>tag</code> will not be set unless it was explicitly defined in the source document; this also applies for unsupported tags that have been resolved using a fallback tag (string, <code>Map</code>, or <code>Seq</code>).</p>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Scalar</span> <span class="kr">extends</span> <span class="nx">Node</span> <span class="p">{</span>
  <span class="nl">value</span><span class="p">:</span> <span class="nx">any</span>
<span class="p">}</span>
</code></pre>
<p>A parsed document&#39;s contents will have all of its non-object values wrapped in <code>Scalar</code> objects, which themselves may be in some hierarchy of <code>Map</code> and <code>Seq</code> collections. However, this is not a requirement for the document&#39;s stringification, which is rather tolerant regarding its input values, and will use <a href="#yaml-createnode"><code>YAML.createNode</code></a> when encountering an unwrapped value.</p>

<h3 id="collections" style="clear:both">Collections</h3>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Pair</span> <span class="kr">extends</span> <span class="nx">Node</span> <span class="p">{</span>
  <span class="nl">key</span><span class="p">:</span> <span class="nx">Node</span> <span class="o">|</span> <span class="nx">any</span><span class="p">,</span>    <span class="c1">// key and value are always Node or null</span>
  <span class="nx">value</span><span class="p">:</span> <span class="nx">Node</span> <span class="o">|</span> <span class="nx">any</span>   <span class="c1">// when parsed, but can be set to anything</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">Map</span> <span class="kr">extends</span> <span class="nx">Node</span> <span class="p">{</span>
  <span class="nl">items</span><span class="p">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">Pair</span><span class="o">&gt;</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">Seq</span> <span class="kr">extends</span> <span class="nx">Node</span> <span class="p">{</span>
  <span class="nl">items</span><span class="p">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">Node</span> <span class="o">|</span> <span class="nx">any</span><span class="o">&gt;</span>
<span class="p">}</span>
</code></pre>
<p>Within a YAML document, two forms of collections are supported: sequential <code>Seq</code> collections and key-value <code>Map</code> collections. The JavaScript representations of these collections both have an <code>items</code> array, which may (<code>Seq</code>) or must (<code>Map</code>) consist of <code>Pair</code> objects that contain a <code>key</code> and a <code>value</code> of any type, including <code>null</code>. The <code>items</code> array of a <code>Seq</code> object may contain values of any type.</p>

<h4 style="clear:both"><code>new Map(), new Seq(), new Pair(key, value)</code></h4>
<pre class="highlight javascript"><code><span class="kr">import</span> <span class="nx">YAML</span> <span class="nx">from</span> <span class="s1">'yaml'</span>
<span class="kr">import</span> <span class="nx">Pair</span> <span class="nx">from</span> <span class="s1">'yaml/pair'</span>
<span class="kr">import</span> <span class="nx">Seq</span> <span class="nx">from</span> <span class="s1">'yaml/seq'</span>

<span class="kr">const</span> <span class="nx">doc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">YAML</span><span class="p">.</span><span class="nx">Document</span><span class="p">()</span>
<span class="nx">doc</span><span class="p">.</span><span class="nx">contents</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Seq</span><span class="p">()</span>
<span class="nx">doc</span><span class="p">.</span><span class="nx">contents</span><span class="p">.</span><span class="nx">items</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'some values'</span><span class="p">,</span>
  <span class="mi">42</span><span class="p">,</span>
  <span class="p">{</span> <span class="na">including</span><span class="p">:</span> <span class="s1">'objects'</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s1">'a string'</span> <span class="p">}</span>
<span class="p">]</span>
<span class="nx">doc</span><span class="p">.</span><span class="nx">contents</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">Pair</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'a number'</span><span class="p">))</span>

<span class="nx">doc</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
<span class="c1">// - some values</span>
<span class="c1">// - 42</span>
<span class="c1">// - "3": a string</span>
<span class="c1">//   including: objects</span>
<span class="c1">// - 1: a number</span>
</code></pre>
<p>To construct a <code>Seq</code> or <code>Map</code>, use <a href="#yaml-createnode"><code>YAML.createNode()</code></a> with array or object input, or create the collections directly by importing the classes from <code>yaml/seq</code> and <code>yaml/map</code>.</p>

<p>Once created, normal array operations may be used to modify the <code>items</code> array. New <code>Pair</code> objects may created by importing the class from <code>yaml/pair</code> and using its <code>new Pair(key, value)</code> constructor. Note in particular that this is required to create non-<code>string</code> keys.</p>
<h2 id='comments'>Comments</h2><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nx">YAML</span><span class="p">.</span><span class="nx">parseDocuments</span><span class="p">(</span><span class="s2">`
# This is YAML.
---
it has:
  - an array
  - of values
`</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="nx">doc</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">()</span>
<span class="c1">// { 'it has': [ 'an array', 'of values' ] }</span>

<span class="nx">doc</span><span class="p">.</span><span class="nx">commentBefore</span>
<span class="c1">// ' This is YAML.'</span>

<span class="kr">const</span> <span class="nx">seq</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">contents</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span>
<span class="nx">seq</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">comment</span> <span class="o">=</span> <span class="s1">' item comment'</span>
<span class="nx">seq</span><span class="p">.</span><span class="nx">comment</span> <span class="o">=</span> <span class="s1">' collection end comment'</span>

<span class="nx">doc</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
<span class="c1">// # This is YAML.</span>
<span class="c1">// it has:</span>
<span class="c1">//   - an array # item comment</span>
<span class="c1">//   - of values</span>
<span class="c1">//   # collection end comment</span>
</code></pre>
<p>A primary differentiator between this and other YAML libraries is the ability to programmatically handle comments, which according to <a href="http://yaml.org/spec/1.2/spec.html#id2767100">the spec</a> &quot;must not have any effect on the serialization tree or representation graph. In particular, comments are not associated with a particular node.&quot;</p>

<p>This library does allow comments to be handled programmatically, and does attach them to particular nodes. Each <code>Scalar</code>, <code>Map</code>, <code>Seq</code> and the <code>Document</code> itself has <code>comment</code> and <code>commentBefore</code> members that may be set to a stringifiable value. The string contents of comments are not processed by the library, except for merging adjacent comment lines together and prefixing each line with the <code>#</code> comment indicator.</p>

<p><strong>Note</strong>: Due to implementation details, the library&#39;s comment handling is not completely stable. In particular, when reading and writing a YAML file, comments may move around a bit due to getting associated with a different node than intended.</p>
<h1 id='cst-parser'>CST Parser</h1>
<p>For ease of implementation and to provide better error handling and reporting, the lowest level of the library&#39;s parser turns any input string into a <a href="https://en.wikipedia.org/wiki/Concrete_syntax_tree"><strong>Concrete Syntax Tree</strong></a> of nodes as if the input were YAML. This level of the API has not been designed to be particularly user-friendly for external users, but it is fast, robust, and not dependent on the rest of the library.</p>
<h2 id='parsecst'>parseCST</h2><pre class="highlight javascript"><code><span class="kr">import</span> <span class="nx">parseCST</span> <span class="nx">from</span> <span class="s1">'yaml/parse-cst'</span>

<span class="kr">const</span> <span class="nx">cst</span> <span class="o">=</span> <span class="nx">parseCST</span><span class="p">(</span><span class="s2">`
sequence: [ one, two, ]
mapping: { sky: blue, sea: green }
---
-
  "flow in block"
- &gt;
 Block scalar
- !!map # Block collection
  foo : bar
`</span><span class="p">)</span>

<span class="nx">cst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>            <span class="c1">// first document, containing a map with two keys</span>
  <span class="p">.</span><span class="nx">contents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>    <span class="c1">// document contents (as opposed to directives)</span>
  <span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="nx">node</span>  <span class="c1">// the last item, a flow map</span>
  <span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>       <span class="c1">// the fourth token, parsed as a plain value</span>
  <span class="p">.</span><span class="nx">strValue</span>       <span class="c1">// 'blue'</span>

<span class="nx">cst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>            <span class="c1">// second document, containing a sequence</span>
  <span class="p">.</span><span class="nx">contents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>    <span class="c1">// document contents (as opposed to directives)</span>
  <span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">node</span>  <span class="c1">// the second item, a block value</span>
  <span class="p">.</span><span class="nx">strValue</span>       <span class="c1">// 'Block scalar\n'</span>
</code></pre><h4 id='parsecst-string-cstdocument'><code>parseCST(string): CSTDocument[]</code></h4>
<p>The CST parser will not produce a CST that is necessarily valid YAML, and in particular its representation of collections of items is expected to undergo further processing and validation. The parser should never throw errors, but may include them as a value of the relevant node. On the other hand, if you feed it garbage, you&#39;ll likely get a garbage CST as well.</p>

<p>The public API of the library is a single function which returns an array of parsed CST documents. The array and its contained nodes override the default <code>toString</code> method, each returning a YAML string representation of its contents.</p>

<p>If a node has its <code>value</code> set, that will be used when re-stringifying. Care should be taken when modifying the CST, as no error checks are included to verify that the resulting YAML is valid, or that e.g. indentation levels aren&#39;t broken. In other words, this is an engineering tool and you may hurt yourself. If you&#39;re looking to generate a brand new YAML document, you should probably not be using this API directly.</p>

<p>For more usage examples and CST trees, have a look through the <a href="https://github.com/eemeli/yaml/tree/master/__tests__/cst">extensive test suite</a> included in the project&#39;s repository.</p>

<h3 style="clear:both">Error detection</h3>
<pre class="highlight javascript"><code><span class="kr">import</span> <span class="nx">YAML</span> <span class="nx">from</span> <span class="s1">'yaml'</span>
<span class="kr">import</span> <span class="nx">parseCST</span> <span class="nx">from</span> <span class="s1">'yaml/parse-cst'</span>

<span class="kr">const</span> <span class="nx">cst</span> <span class="o">=</span> <span class="nx">parseCST</span><span class="p">(</span><span class="s1">'this: is: bad YAML'</span><span class="p">)</span>

<span class="nx">cst</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">contents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1">// Note: Simplified for clarity</span>
<span class="c1">// { type: 'MAP',</span>
<span class="c1">//   items: [</span>
<span class="c1">//     { type: 'PLAIN', strValue: 'this' },</span>
<span class="c1">//     { type: 'MAP_VALUE',</span>
<span class="c1">//       node: {</span>
<span class="c1">//         type: 'MAP',</span>
<span class="c1">//         items: [</span>
<span class="c1">//           { type: 'PLAIN', strValue: 'is' },</span>
<span class="c1">//           { type: 'MAP_VALUE',</span>
<span class="c1">//             node: { type: 'PLAIN', strValue: 'bad YAML' } } ] } } ] }</span>

<span class="kr">const</span> <span class="nx">doc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">YAML</span><span class="p">.</span><span class="nx">Document</span><span class="p">()</span>
<span class="nx">doc</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">cst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nx">doc</span><span class="p">.</span><span class="nx">errors</span>
<span class="c1">// [ {</span>
<span class="c1">//   name: 'YAMLSemanticError',</span>
<span class="c1">//   message: 'Nested mappings are not allowed in compact mappings',</span>
<span class="c1">//   source: {</span>
<span class="c1">//     type: 'MAP',</span>
<span class="c1">//     range: { start: 6, end: 18 },</span>
<span class="c1">//     ...,</span>
<span class="c1">//     rawValue: 'is: bad YAML' } } ]</span>

<span class="nx">doc</span><span class="p">.</span><span class="nx">contents</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">.</span><span class="nx">value</span>
<span class="c1">// 'bad YAML'</span>
</code></pre>
<p>While the YAML spec considers e.g. block collections within a flow collection to be an error, this error will not be detected by the CST parser. For complete validation, you will need to parse the CST into a <code>YAML.Document</code>. If the document contains errors, they will be included in the document&#39;s <code>errors</code> array, and each error will will contain a <code>source</code> reference to the CST node where it was encountered. Do note that even if an error is encountered, the document contents might still be available. In such a case, the error will be a <a href="#yamlsemanticerror"><code>YAMLSemanticError</code></a> rather than a <a href="#yamlsyntaxerror"><code>YAMLSyntaxError</code></a>.</p>
<h2 id='cst-nodes'>CST Nodes</h2>
<blockquote>
<p>Node type definitions use Flow-ish notation, so <code>+</code> as a prefix indicates a read-only getter property.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Range</span> <span class="p">{</span>
  <span class="nl">start</span><span class="p">:</span> <span class="nx">number</span><span class="p">,</span>        <span class="c1">// offset of first character</span>
  <span class="nx">end</span><span class="p">:</span> <span class="nx">number</span><span class="p">,</span>          <span class="c1">// offset after last character</span>
  <span class="o">+</span><span class="nx">isEmpty</span><span class="p">:</span> <span class="kr">boolean</span>     <span class="c1">// true if end is not greater than start</span>
<span class="p">}</span>
</code></pre>
<p><strong>Note</strong>: The <code>Node</code>, <code>Scalar</code> and other values referred to in this section are the CST representations of said objects, and are not the same as those used in preceding parts.</p>

<p>Actual values in the CST nodes are stored as <code>start</code>, <code>end</code> indices of the input string. This allows for memory consumption to be minimised by making string generation really lazy.</p>

<h3 style="clear:both">Node</h3>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Node</span> <span class="p">{</span>
  <span class="nl">context</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">atLineStart</span><span class="p">:</span> <span class="kr">boolean</span><span class="p">,</span> <span class="c1">// is this node the first one on this line</span>
    <span class="nx">indent</span><span class="p">:</span> <span class="nx">number</span><span class="p">,</span>     <span class="c1">// current level of indentation (may be -1)</span>
    <span class="nx">src</span><span class="p">:</span> <span class="nx">string</span>         <span class="c1">// the full original source</span>
  <span class="p">},</span>
  <span class="nx">error</span><span class="p">:</span> <span class="p">?</span><span class="nb">Error</span><span class="p">,</span>        <span class="c1">// if not null, indicates a parser failure</span>
  <span class="nx">props</span><span class="p">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">Range</span><span class="o">&gt;</span><span class="p">,</span>  <span class="c1">// anchors, tags and comments</span>
  <span class="nx">range</span><span class="p">:</span> <span class="nx">Range</span><span class="p">,</span>         <span class="c1">// span of context.src parsed into this node</span>
  <span class="nx">type</span><span class="p">:</span>                 <span class="c1">// specific node type</span>
    <span class="s1">'ALIAS'</span> <span class="o">|</span> <span class="s1">'BLOCK_FOLDED'</span> <span class="o">|</span> <span class="s1">'BLOCK_LITERAL'</span> <span class="o">|</span> <span class="s1">'COMMENT'</span> <span class="o">|</span>
    <span class="s1">'DIRECTIVE'</span> <span class="o">|</span> <span class="s1">'DOCUMENT'</span> <span class="o">|</span> <span class="s1">'FLOW_MAP'</span> <span class="o">|</span> <span class="s1">'FLOW_SEQ'</span> <span class="o">|</span>
    <span class="s1">'MAP'</span> <span class="o">|</span> <span class="s1">'MAP_KEY'</span> <span class="o">|</span> <span class="s1">'MAP_VALUE'</span> <span class="o">|</span> <span class="s1">'PLAIN'</span> <span class="o">|</span>
    <span class="s1">'QUOTE_DOUBLE'</span> <span class="o">|</span> <span class="s1">'QUOTE_SINGLE'</span> <span class="o">|</span> <span class="s1">'SEQ'</span> <span class="o">|</span> <span class="s1">'SEQ_ITEM'</span><span class="p">,</span>
  <span class="nx">value</span><span class="p">:</span> <span class="p">?</span><span class="nx">string</span>        <span class="c1">// if set to a non-null value, overrides</span>
                        <span class="c1">//   source value when stringified</span>
  <span class="o">+</span><span class="nx">anchor</span><span class="p">:</span> <span class="p">?</span><span class="nx">string</span><span class="p">,</span>     <span class="c1">// anchor, if set</span>
  <span class="o">+</span><span class="nx">comment</span><span class="p">:</span> <span class="p">?</span><span class="nx">string</span><span class="p">,</span>    <span class="c1">// newline-delimited comment(s), if any</span>
  <span class="o">+</span><span class="nx">rawValue</span><span class="p">:</span> <span class="p">?</span><span class="nx">string</span><span class="p">,</span>   <span class="c1">// an unprocessed slice of context.src</span>
                        <span class="c1">//   determining this node's value</span>
  <span class="o">+</span><span class="nx">tag</span><span class="p">:</span>                 <span class="c1">// this node's tag, if set</span>
    <span class="kc">null</span> <span class="o">|</span> <span class="p">{</span> <span class="na">verbatim</span><span class="p">:</span> <span class="nx">string</span> <span class="p">}</span> <span class="o">|</span> <span class="p">{</span> <span class="na">handle</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span> <span class="na">suffix</span><span class="p">:</span> <span class="nx">string</span> <span class="p">},</span>
  <span class="nx">toString</span><span class="p">():</span> <span class="nx">string</span>    <span class="c1">// a YAML string representation of this node</span>
<span class="p">}</span>

<span class="nx">type</span> <span class="nx">ContentNode</span> <span class="o">=</span>
  <span class="nx">Comment</span> <span class="o">|</span> <span class="nx">Alias</span> <span class="o">|</span> <span class="nx">Scalar</span> <span class="o">|</span> <span class="nx">Map</span> <span class="o">|</span> <span class="nx">Seq</span> <span class="o">|</span> <span class="nx">FlowCollection</span>
</code></pre>
<p>Each node in the CST extends a common ancestor <code>Node</code>. Additional undocumented properties are available, but are likely only useful during parsing.</p>

<h3 style="clear:both">Scalars</h3>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Alias</span> <span class="kr">extends</span> <span class="nx">Node</span> <span class="p">{</span>
  <span class="c1">// rawValue will contain the anchor without the * prefix</span>
  <span class="nl">type</span><span class="p">:</span> <span class="s1">'ALIAS'</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">Scalar</span> <span class="kr">extends</span> <span class="nx">Node</span> <span class="p">{</span>
  <span class="nl">type</span><span class="p">:</span> <span class="s1">'PLAIN'</span> <span class="o">|</span> <span class="s1">'QUOTE_DOUBLE'</span> <span class="o">|</span> <span class="s1">'QUOTE_SINGLE'</span> <span class="o">|</span>
    <span class="s1">'BLOCK_FOLDED'</span> <span class="o">|</span> <span class="s1">'BLOCK_LITERAL'</span>
  <span class="o">+</span><span class="nx">strValue</span><span class="p">:</span> <span class="p">?</span><span class="nx">string</span> <span class="o">|</span>  <span class="c1">// unescaped string value</span>
    <span class="p">{</span> <span class="na">str</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span> <span class="na">errors</span><span class="p">:</span> <span class="nx">YAMLSyntaxError</span><span class="p">[]</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">Comment</span> <span class="kr">extends</span> <span class="nx">Node</span> <span class="p">{</span>
  <span class="nl">type</span><span class="p">:</span> <span class="s1">'COMMENT'</span><span class="p">,</span>      <span class="c1">// PLAIN nodes may also be comment-only</span>
  <span class="o">+</span><span class="nx">anchor</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="o">+</span><span class="nx">comment</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
  <span class="o">+</span><span class="nx">rawValue</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="o">+</span><span class="nx">tag</span><span class="p">:</span> <span class="kc">null</span>
<span class="p">}</span>
</code></pre>
<p>While <code>Alias</code> and <code>Comment</code> nodes are not technically scalars, they are parsed as such at this level.</p>

<p>Due to parsing differences, each scalar type is implemented using its own class.</p>

<h3 style="clear:both">Collections</h3>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">MapItem</span> <span class="kr">extends</span> <span class="nx">Node</span> <span class="p">{</span>
  <span class="nl">node</span><span class="p">:</span> <span class="nx">ContentNode</span> <span class="o">|</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nx">type</span><span class="p">:</span> <span class="s1">'MAP_KEY'</span> <span class="o">|</span> <span class="s1">'MAP_VALUE'</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">Map</span> <span class="kr">extends</span> <span class="nx">Node</span> <span class="p">{</span>
  <span class="c1">// implicit keys are not wrapped</span>
  <span class="nl">items</span><span class="p">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">Comment</span> <span class="o">|</span> <span class="nx">Alias</span> <span class="o">|</span> <span class="nx">Scalar</span> <span class="o">|</span> <span class="nx">MapItem</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="nx">type</span><span class="p">:</span> <span class="s1">'MAP'</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">SeqItem</span> <span class="kr">extends</span> <span class="nx">Node</span> <span class="p">{</span>
  <span class="nl">node</span><span class="p">:</span> <span class="nx">ContentNode</span> <span class="o">|</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nx">type</span><span class="p">:</span> <span class="s1">'SEQ_ITEM'</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">Seq</span> <span class="kr">extends</span> <span class="nx">Node</span> <span class="p">{</span>
  <span class="nl">items</span><span class="p">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">Comment</span> <span class="o">|</span> <span class="nx">SeqItem</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="nx">type</span><span class="p">:</span> <span class="s1">'SEQ'</span>
<span class="p">}</span>

<span class="nx">type</span> <span class="nx">FlowChar</span> <span class="o">=</span> <span class="s1">'{'</span> <span class="o">|</span> <span class="s1">'}'</span> <span class="o">|</span> <span class="s1">'['</span> <span class="o">|</span> <span class="s1">']'</span> <span class="o">|</span> <span class="s1">','</span> <span class="o">|</span> <span class="s1">'?'</span> <span class="o">|</span> <span class="s1">':'</span>

<span class="kr">class</span> <span class="nx">FlowCollection</span> <span class="kr">extends</span> <span class="nx">Node</span> <span class="p">{</span>
  <span class="nl">items</span><span class="p">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">FlowChar</span> <span class="o">|</span> <span class="nx">Comment</span> <span class="o">|</span> <span class="nx">Alias</span> <span class="o">|</span> <span class="nx">Scalar</span> <span class="o">|</span> <span class="nx">FlowCollection</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="nx">type</span><span class="p">:</span> <span class="s1">'FLOW_MAP'</span> <span class="o">|</span> <span class="s1">'FLOW_SEQ'</span>
<span class="p">}</span>
</code></pre>
<p>Block and flow collections are parsed rather differently, due to their representation differences.</p>

<p>An <code>Alias</code> or <code>Scalar</code> item directly within a <code>Map</code> should be treated as an implicit map key.</p>

<p>In actual code, <code>MapItem</code> and <code>SeqItem</code> are implemented as <code>CollectionItem</code>, and correspondingly <code>Map</code> and <code>Seq</code> as <code>Collection</code>.</p>

<h3 style="clear:both">Document Structure</h3>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Directive</span> <span class="kr">extends</span> <span class="nx">Node</span> <span class="p">{</span>
  <span class="nl">name</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span>  <span class="c1">// should only be 'TAG' or 'YAML'</span>
  <span class="nx">type</span><span class="p">:</span> <span class="s1">'DIRECTIVE'</span><span class="p">,</span>
  <span class="o">+</span><span class="nx">anchor</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="o">+</span><span class="nx">parameters</span><span class="p">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="o">+</span><span class="nx">tag</span><span class="p">:</span> <span class="kc">null</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">CSTDocument</span> <span class="kr">extends</span> <span class="nx">Node</span> <span class="p">{</span>
  <span class="nl">directives</span><span class="p">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">Comment</span> <span class="o">|</span> <span class="nx">Directive</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="nx">contents</span><span class="p">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">ContentNode</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="nx">type</span><span class="p">:</span> <span class="s1">'DOCUMENT'</span><span class="p">,</span>
  <span class="o">+</span><span class="nx">anchor</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="o">+</span><span class="nx">comment</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="o">+</span><span class="nx">tag</span><span class="p">:</span> <span class="kc">null</span>
<span class="p">}</span>
</code></pre>
<p>The CST tree of a valid YAML document should have a single non-<code>Comment</code> <code>ContentNode</code> in its <code>contents</code> array. Multiple values indicates that the input is malformed in a way that made it impossible to determine the proper structure of the document.</p>
<h1 id='errors'>Errors</h1>
<p>All errors and warnings produced by the <code>yaml</code> parser functions contain the following fields:</p>

<table><thead>
<tr>
<th>Member</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td><code>string</code></td>
<td>One of <code>YAMLReferenceError</code>, <code>YAMLSemanticError</code>, <code>YAMLSyntaxError</code>, or <code>YAMLWarning</code></td>
</tr>
<tr>
<td>message</td>
<td><code>string</code></td>
<td>A human-readable description of the error</td>
</tr>
<tr>
<td>source</td>
<td><code>CST Node</code></td>
<td>The CST node at which this error or warning was encountered</td>
</tr>
</tbody></table>
<h2 id='yamlreferenceerror'>YAMLReferenceError</h2>
<p>An error resolving a tag or an anchor that is referred to in the source. It is likely that the contents of the <code>source</code> node have not been completely parsed into the document. Not used by the CST parser.</p>
<h2 id='yamlsemanticerror'>YAMLSemanticError</h2>
<p>An error related to the metadata of the document, or an error with limitations imposed by the YAML spec. The data contents of the document should be valid, but the metadata may be broken.</p>
<h2 id='yamlsyntaxerror'>YAMLSyntaxError</h2>
<p>A serious parsing error; the document contents will not be complete, and the CST is likely to be rather broken.</p>
<h2 id='yamlwarning'>YAMLWarning</h2>
<p>Not an error, but a spec-mandated warning about unsupported directives or a fallback resolution being used for a node with an unavailable tag. Not used by the CST parser.</p>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
